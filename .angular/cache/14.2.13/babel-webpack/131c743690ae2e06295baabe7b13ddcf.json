{"ast":null,"code":"import _asyncToGenerator from \"F:/Bovis/Front/bovis-dev/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { FacrurasNC, InfoProyecto, LstFacturas } from '../../Models/FacturacionModels';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/facturacion.service\";\nimport * as i2 from \"primeng/api\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"primeng/button\";\nimport * as i5 from \"primeng/fileupload\";\nimport * as i6 from \"primeng/toast\";\nimport * as i7 from \"primeng/table\";\nimport * as i8 from \"primeng/message\";\nconst _c0 = [\"fileUpload\"];\n\nfunction FacturaCrpComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 3);\n    i0.ɵɵelement(1, \"br\")(2, \"i\", 10);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction FacturaCrpComponent_p_button_11_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"p-button\", 11);\n    i0.ɵɵlistener(\"onClick\", function FacturaCrpComponent_p_button_11_Template_p_button_onClick_0_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.clearFile());\n    });\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction FacturaCrpComponent_div_13_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"th\");\n    i0.ɵɵtext(2, \"Conceptos\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"th\");\n    i0.ɵɵtext(4, \"Rfc Emisor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Rfc Receptor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Fecha\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Total\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\");\n    i0.ɵɵtext(12, \"Tipo Factura\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"th\");\n    i0.ɵɵtext(14, \"No. Factura\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"th\");\n    i0.ɵɵtext(16, \"Nombre Factura\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"th\");\n    i0.ɵɵtext(18, \"Almacenada\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"th\");\n    i0.ɵɵtext(20, \"Error\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction FacturaCrpComponent_div_13_ng_template_3_ng_container_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \" Si \");\n    i0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction FacturaCrpComponent_div_13_ng_template_3_ng_container_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \" No \");\n    i0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction FacturaCrpComponent_div_13_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"td\");\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"td\");\n    i0.ɵɵtemplate(18, FacturaCrpComponent_div_13_ng_template_3_ng_container_18_Template, 2, 0, \"ng-container\", 9);\n    i0.ɵɵtemplate(19, FacturaCrpComponent_div_13_ng_template_3_ng_container_19_Template, 2, 0, \"ng-container\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"td\");\n    i0.ɵɵtext(21);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const xml_r9 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", xml_r9.conceptos, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r9.rfcEmisor);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r9.rfcReceptor);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r9.fechaEmision);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r9.total);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r9.tipoFactura);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r9.noFactura);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r9.facturaNombre);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", xml_r9.almacenada);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !xml_r9.almacenada);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r9.error);\n  }\n}\n\nconst _c1 = function () {\n  return {\n    \"min-width\": \"50rem\"\n  };\n};\n\nfunction FacturaCrpComponent_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p-table\", 12);\n    i0.ɵɵtemplate(2, FacturaCrpComponent_div_13_ng_template_2_Template, 21, 0, \"ng-template\", 13);\n    i0.ɵɵtemplate(3, FacturaCrpComponent_div_13_ng_template_3_Template, 22, 11, \"ng-template\", 14);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"value\", ctx_r3.listResponse)(\"tableStyle\", i0.ɵɵpureFunction0(2, _c1));\n  }\n}\n\nfunction FacturaCrpComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"p-message\", 15);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"text\", ctx_r4.errorMEssageFile);\n  }\n}\n\nexport class FacturaCrpComponent {\n  constructor(cargaFileServ, messageService) {\n    this.cargaFileServ = cargaFileServ;\n    this.messageService = messageService;\n    this.isLoadingFacturas = false;\n    this.fileSizeMax = 1000000;\n    this.isClear = false;\n    this.strFileBase64 = '';\n    this.listFacturasBase64 = new Array();\n    this.infoProyecto = new InfoProyecto();\n    this.errorMEssageFile = '';\n  }\n\n  ngOnInit() {}\n\n  onBasicUpload(event) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (event && event.files) {\n        //console.log('length: ' + event.files.length);\n        _this.isLoadingFacturas = true;\n        yield _this.convertXML(event.files); //console.log(this.listFacturasBase64);\n\n        setTimeout(() => {\n          _this.cargaFile();\n        }, 3000);\n      }\n    })();\n  }\n\n  convertXML(files) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      return new Promise((resolve, reject) => {\n        let listFacturasBase64Sub = new Array();\n\n        for (let file of files) {\n          let reader = new FileReader();\n\n          reader.onload = evt => {\n            const xmlData = evt.target.result;\n            var parser = new DOMParser();\n            var xmlz = parser.parseFromString(xmlData, \"application/xml\");\n            _this2.strFileBase64 = window.btoa(new XMLSerializer().serializeToString(xmlz));\n            let stXML = new LstFacturas();\n            stXML.NombreFactura = file.name;\n            stXML.FacturaB64 = _this2.strFileBase64; //console.log(stXML);\n\n            _this2.listFacturasBase64.push(stXML); //listFacturasBase64Sub.push(stXML);\n\n\n            resolve(listFacturasBase64Sub);\n          };\n\n          reader.onerror = reject;\n          reader.readAsText(file);\n        }\n      });\n    })();\n  }\n\n  cargaFile() {\n    let procesaFactura = new FacrurasNC();\n    this.listFacturasBase64.forEach(element => {\n      procesaFactura.LstFacturas.push(element);\n    });\n    this.listResponse = new Array();\n\n    try {\n      this.cargaFileServ.cargaXML_CRP(procesaFactura).subscribe({\n        next: data => {\n          //console.log(data);\n          if (data.success) {\n            this.listResponse = data.data; //console.log(this.listResponse);\n\n            this.messageService.add({\n              severity: \"success\",\n              summary: \"Validar\",\n              detail: \"Facturas procesadas\",\n              life: 2000\n            });\n          }\n        },\n        error: e => {\n          //console.log(e);\n          let error = `${e.message} \\n\\n ${e.error}`;\n          this.messageService.add({\n            severity: \"error\",\n            summary: \"Error\",\n            detail: error,\n            life: 2000\n          });\n          this.errorMEssageFile = error;\n        }\n      });\n      this.isLoadingFacturas = false;\n      this.isClear = true;\n    } catch (err) {\n      console.log(err);\n      this.messageService.add({\n        severity: \"error\",\n        summary: \"Error\",\n        detail: String(err)\n      });\n    }\n  }\n\n  clearFile() {\n    this.isClear = !this.isClear;\n    this.fileUpload.clear();\n    this.listResponse = new Array();\n    this.errorMEssageFile = '';\n    this.listFacturasBase64 = new Array();\n    this.listResponse = new Array();\n  }\n\n}\n\nFacturaCrpComponent.ɵfac = function FacturaCrpComponent_Factory(t) {\n  return new (t || FacturaCrpComponent)(i0.ɵɵdirectiveInject(i1.FacturacionService), i0.ɵɵdirectiveInject(i2.MessageService));\n};\n\nFacturaCrpComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: FacturaCrpComponent,\n  selectors: [[\"app-factura-crp\"]],\n  viewQuery: function FacturaCrpComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5);\n    }\n\n    if (rf & 2) {\n      let _t;\n\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.fileUpload = _t.first);\n    }\n  },\n  decls: 16,\n  vars: 7,\n  consts: [[1, \"content\", 2, \"margin\", \"2%\"], [1, \"\"], [1, \"formgroup-inline\"], [1, \"field\"], [\"for\", \"concepto\"], [\"mode\", \"basic\", \"accept\", \".xml\", \"chooseLabel\", \"Cargar XML\", 3, \"customUpload\", \"multiple\", \"maxFileSize\", \"onSelect\"], [\"fileUpload\", \"\"], [\"class\", \"field\", 4, \"ngIf\"], [\"icon\", \"pi pi-refresh\", \"label\", \"Limpiar carga\", 3, \"onClick\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"pi\", \"pi-spin\", \"pi-spinner\", 2, \"font-size\", \"2rem\"], [\"icon\", \"pi pi-refresh\", \"label\", \"Limpiar carga\", 3, \"onClick\"], [\"styleClass\", \"p-datatable-striped\", 3, \"value\", \"tableStyle\"], [\"pTemplate\", \"header\"], [\"pTemplate\", \"body\"], [\"severity\", \"error\", 3, \"text\"]],\n  template: function FacturaCrpComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"label\", 4);\n      i0.ɵɵtext(5, \"Seleccion de Factruras:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"p-fileUpload\", 5, 6);\n      i0.ɵɵlistener(\"onSelect\", function FacturaCrpComponent_Template_p_fileUpload_onSelect_6_listener($event) {\n        return ctx.onBasicUpload($event);\n      });\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(8, FacturaCrpComponent_div_8_Template, 3, 0, \"div\", 7);\n      i0.ɵɵelementStart(9, \"div\", 3);\n      i0.ɵɵelement(10, \"br\");\n      i0.ɵɵtemplate(11, FacturaCrpComponent_p_button_11_Template, 1, 0, \"p-button\", 8);\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelement(12, \"br\");\n      i0.ɵɵtemplate(13, FacturaCrpComponent_div_13_Template, 4, 3, \"div\", 9);\n      i0.ɵɵtemplate(14, FacturaCrpComponent_div_14_Template, 2, 1, \"div\", 9);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(15, \"p-toast\");\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"customUpload\", true)(\"multiple\", true)(\"maxFileSize\", ctx.fileSizeMax);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.isLoadingFacturas);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngIf\", ctx.isClear);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.listResponse && ctx.listResponse.length > 0);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.errorMEssageFile != \"\");\n    }\n  },\n  dependencies: [i3.NgIf, i2.PrimeTemplate, i4.Button, i5.FileUpload, i6.Toast, i7.Table, i8.UIMessage],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJmYWN0dXJhLWNycC5jb21wb25lbnQuc2NzcyJ9 */\"]\n});","map":{"version":3,"mappings":"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","names":["FacrurasNC","InfoProyecto","LstFacturas","i0","FacturaCrpComponent","constructor","cargaFileServ","messageService","Array","ngOnInit","onBasicUpload","event","files","isLoadingFacturas","convertXML","setTimeout","cargaFile","Promise","resolve","reject","listFacturasBase64Sub","file","reader","FileReader","onload","evt","xmlData","target","result","parser","DOMParser","xmlz","parseFromString","strFileBase64","window","btoa","XMLSerializer","serializeToString","stXML","NombreFactura","name","FacturaB64","listFacturasBase64","push","onerror","readAsText","procesaFactura","forEach","element","listResponse","cargaXML_CRP","subscribe","next","data","success","add","severity","summary","detail","life","error","e","message","errorMEssageFile","isClear","err","console","log","String","clearFile","fileUpload","clear","selectors","viewQuery","ctx"],"sourceRoot":"","sources":["F:\\Bovis\\Front\\bovis-dev\\src\\app\\facturacion\\components\\factura-crp\\factura-crp.component.ts","F:\\Bovis\\Front\\bovis-dev\\src\\app\\facturacion\\components\\factura-crp\\factura-crp.component.html"],"sourcesContent":["import { Component, OnInit, ViewChild } from '@angular/core';\r\nimport { FacrurasNC, InfoProyecto, LstFacturas, ResponseXML } from '../../Models/FacturacionModels';\r\nimport { FacturacionService } from '../../services/facturacion.service';\r\nimport { MessageService } from 'primeng/api';\r\n\r\n@Component({\r\n  selector: 'app-factura-crp',\r\n  templateUrl: './factura-crp.component.html',\r\n  styleUrls: ['./factura-crp.component.scss']\r\n})\r\nexport class FacturaCrpComponent implements OnInit {\r\n\r\n  isLoadingFacturas: boolean = false;\r\n  fileSizeMax = 1000000;\r\n  isClear: boolean = false;\r\n  strFileBase64: string = '';\r\n  listFacturasBase64: Array<LstFacturas> = new Array<LstFacturas>();\r\n  infoProyecto: InfoProyecto = new InfoProyecto();\r\n  @ViewChild('fileUpload') fileUpload: any;\r\n  listResponse: Array<ResponseXML>;\r\n  errorMEssageFile: string = '';\r\n\r\n  constructor(private cargaFileServ: FacturacionService,\r\n    private messageService: MessageService) { }\r\n\r\n  ngOnInit(): void {\r\n  }\r\n\r\n  async onBasicUpload(event: any) {\r\n    if (event && event.files) {\r\n      //console.log('length: ' + event.files.length);\r\n      this.isLoadingFacturas = true;\r\n      await this.convertXML(event.files)\r\n      //console.log(this.listFacturasBase64);\r\n\r\n      setTimeout(\r\n        ()=>{\r\n        this.cargaFile()\r\n      },3000);\r\n    }\r\n  }\r\n\r\n  async convertXML(files: any) {\r\n    return new Promise((resolve, reject) => {\r\n      let listFacturasBase64Sub: Array<LstFacturas> = new Array<LstFacturas>();\r\n      for (let file of files) {\r\n        let reader = new FileReader();\r\n        reader.onload = (evt) => {\r\n          const xmlData: string = (evt as any).target.result;\r\n          var parser = new DOMParser();\r\n          var xmlz = parser.parseFromString(xmlData, \"application/xml\");\r\n          this.strFileBase64 = window.btoa((new XMLSerializer()).serializeToString(xmlz));\r\n          let stXML: LstFacturas = new LstFacturas();\r\n          stXML.NombreFactura = file.name;\r\n          stXML.FacturaB64 = this.strFileBase64\r\n          //console.log(stXML);\r\n          this.listFacturasBase64.push(stXML);\r\n          //listFacturasBase64Sub.push(stXML);\r\n          resolve(listFacturasBase64Sub);\r\n        };\r\n        reader.onerror = reject;\r\n        reader.readAsText(file);\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n  cargaFile() {\r\n\r\n    let procesaFactura: FacrurasNC = new FacrurasNC();\r\n\r\n    this.listFacturasBase64.forEach(element => {\r\n      procesaFactura.LstFacturas.push(element);\r\n    });\r\n\r\n    this.listResponse = new Array<ResponseXML>();\r\n    try {\r\n      this.cargaFileServ.cargaXML_CRP(procesaFactura).subscribe({\r\n        next: (data) => {\r\n          //console.log(data);\r\n          if (data.success) {\r\n            this.listResponse = data.data;\r\n            //console.log(this.listResponse);\r\n            this.messageService.add({\r\n              severity: \"success\",\r\n              summary: \"Validar\",\r\n              detail: \"Facturas procesadas\",\r\n              life: 2000\r\n            });\r\n          }\r\n        },\r\n        error: (e) => {\r\n          //console.log(e);\r\n          let error = `${e.message} \\n\\n ${e.error}`\r\n          this.messageService.add({\r\n            severity: \"error\",\r\n            summary: \"Error\",\r\n            detail: error,\r\n            life: 2000\r\n          });\r\n\r\n          this.errorMEssageFile = error;\r\n        }\r\n\r\n      })\r\n      this.isLoadingFacturas = false;\r\n      this.isClear = true;\r\n    } catch (err) {\r\n      console.log(err);\r\n      this.messageService.add({\r\n        severity: \"error\",\r\n        summary: \"Error\",\r\n        detail: String(err)\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n  clearFile() {\r\n    this.isClear = !this.isClear\r\n    this.fileUpload.clear();\r\n    this.listResponse = new Array<ResponseXML>();\r\n    this.errorMEssageFile = '';\r\n    this.listFacturasBase64 = new Array<LstFacturas>();\r\n    this.listResponse = new Array<ResponseXML>();\r\n  }\r\n\r\n}\r\n","<div class=\"content\" style=\"margin:2%\">\r\n\r\n  <div class=\"\">\r\n\r\n    <div class=\"formgroup-inline\">\r\n\r\n      <div class=\"field\">\r\n        <label for=\"concepto\">Seleccion de Factruras:</label>\r\n        <p-fileUpload #fileUpload mode=\"basic\" [customUpload]=\"true\" accept=\".xml\" (onSelect)=\"onBasicUpload($event)\"\r\n          [multiple]=\"true\" [maxFileSize]=\"fileSizeMax\" chooseLabel=\"Cargar XML\"></p-fileUpload>\r\n      </div>\r\n      <div class=\"field\" *ngIf=\"isLoadingFacturas\">\r\n        <br>\r\n        <i class=\"pi pi-spin pi-spinner\" style=\"font-size: 2rem\"></i>\r\n      </div>\r\n      <div class=\"field\">\r\n        <br>\r\n        <p-button *ngIf=\"isClear\" icon=\"pi pi-refresh\" (onClick)=\"clearFile()\" label=\"Limpiar carga\"></p-button>\r\n      </div>\r\n\r\n\r\n    </div>\r\n  </div>\r\n  <br>\r\n\r\n  <div *ngIf=\"listResponse && listResponse.length > 0\">\r\n    <p-table [value]=\"listResponse\" styleClass=\"p-datatable-striped\" [tableStyle]=\"{'min-width': '50rem'}\">\r\n      <ng-template pTemplate=\"header\">\r\n        <tr>\r\n          <th>Conceptos</th>\r\n          <th>Rfc Emisor</th>\r\n          <th>Rfc Receptor</th>\r\n          <th>Fecha</th>\r\n          <th>Total</th>\r\n          <th>Tipo Factura</th>\r\n          <th>No. Factura</th>\r\n          <th>Nombre Factura</th>\r\n          <th>Almacenada</th>\r\n          <th>Error</th>\r\n        </tr>\r\n      </ng-template>\r\n      <ng-template pTemplate=\"body\" let-xml>\r\n        <tr>\r\n          <td>\r\n            {{xml.conceptos}}\r\n          </td>\r\n          <td>{{xml.rfcEmisor}}</td>\r\n          <td>{{xml.rfcReceptor}}</td>\r\n          <td>{{xml.fechaEmision}}</td>\r\n          <td>{{xml.total}}</td>\r\n          <td>{{xml.tipoFactura}}</td>\r\n          <td>{{xml.noFactura}}</td>\r\n          <td>{{xml.facturaNombre}}</td>\r\n          <td>\r\n            <ng-container *ngIf=\"xml.almacenada\">\r\n              Si\r\n            </ng-container>\r\n            <ng-container *ngIf=\"!xml.almacenada\">\r\n              No\r\n            </ng-container>\r\n\r\n          </td>\r\n          <td>{{xml.error}}</td>\r\n        </tr>\r\n      </ng-template>\r\n    </p-table>\r\n  </div>\r\n\r\n  <div *ngIf=\"errorMEssageFile != ''\">\r\n    <p-message severity=\"error\" [text]=\"errorMEssageFile\"></p-message>\r\n  </div>\r\n\r\n</div>\r\n\r\n<p-toast></p-toast>\r\n"]},"metadata":{},"sourceType":"module"}