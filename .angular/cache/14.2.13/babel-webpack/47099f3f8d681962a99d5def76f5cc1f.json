{"ast":null,"code":"import _asyncToGenerator from \"F:/Bovis/Front/bovis-dev/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { inject } from '@angular/core';\nimport { FacturacionService } from '../../services/facturacion.service';\nimport { MessageService } from 'primeng/api';\nimport { InfoProyecto, LstFacturas, NotaCreditoSF, ResponseXML } from '../../Models/FacturacionModels';\nimport { TimesheetService } from 'src/app/timesheet/services/timesheet.service';\nimport { SharedService } from 'src/app/shared/services/shared.service';\nimport { finalize, forkJoin } from 'rxjs';\nimport { EXCEL_EXTENSION, TITLES, errorsArray } from 'src/utils/constants';\nimport * as ExcelJS from 'exceljs';\nimport { saveAs } from 'file-saver';\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { format } from 'date-fns';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"primeng/tooltip\";\nimport * as i4 from \"primeng/api\";\nimport * as i5 from \"primeng/button\";\nimport * as i6 from \"primeng/toolbar\";\nimport * as i7 from \"primeng/fileupload\";\nimport * as i8 from \"primeng/toast\";\nimport * as i9 from \"primeng/table\";\nimport * as i10 from \"primeng/message\";\nimport * as i11 from \"primeng/dropdown\";\nimport * as i12 from \"primeng/calendar\";\nimport * as i13 from \"primeng/dialog\";\nimport * as i14 from \"primeng/inputtextarea\";\nconst _c0 = [\"fileUpload\"];\n\nfunction NotaCreditoSinFacturaComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 4);\n    i0.ɵɵelement(1, \"br\")(2, \"i\", 33);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction NotaCreditoSinFacturaComponent_p_button_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"p-button\", 34);\n    i0.ɵɵlistener(\"onClick\", function NotaCreditoSinFacturaComponent_p_button_17_Template_p_button_onClick_0_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.clearFile());\n    });\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction NotaCreditoSinFacturaComponent_div_33_ng_template_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"th\");\n    i0.ɵɵtext(2, \"Conceptos\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"th\");\n    i0.ɵɵtext(4, \"Rfc Emisor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Rfc Receptor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Fecha\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Total\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\");\n    i0.ɵɵtext(12, \"Tipo Factura\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"th\");\n    i0.ɵɵtext(14, \"No. Factura\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"th\");\n    i0.ɵɵtext(16, \"Nombre Factura\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"th\");\n    i0.ɵɵtext(18, \"Almacenada\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"th\");\n    i0.ɵɵtext(20, \"Error\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction NotaCreditoSinFacturaComponent_div_33_ng_template_3_ng_container_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \" Si \");\n    i0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction NotaCreditoSinFacturaComponent_div_33_ng_template_3_ng_container_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \" No \");\n    i0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction NotaCreditoSinFacturaComponent_div_33_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"td\");\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"td\");\n    i0.ɵɵtemplate(18, NotaCreditoSinFacturaComponent_div_33_ng_template_3_ng_container_18_Template, 2, 0, \"ng-container\", 16);\n    i0.ɵɵtemplate(19, NotaCreditoSinFacturaComponent_div_33_ng_template_3_ng_container_19_Template, 2, 0, \"ng-container\", 16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"td\");\n    i0.ɵɵtext(21);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const xml_r13 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", xml_r13.conceptos, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r13.rfcEmisor);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r13.rfcReceptor);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r13.fechaEmision);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r13.total);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r13.tipoFactura);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r13.noFactura);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r13.facturaNombre);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", xml_r13.almacenada);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !xml_r13.almacenada);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(xml_r13.error);\n  }\n}\n\nconst _c1 = function () {\n  return {\n    \"min-width\": \"50rem\"\n  };\n};\n\nfunction NotaCreditoSinFacturaComponent_div_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"p-table\", 35);\n    i0.ɵɵtemplate(2, NotaCreditoSinFacturaComponent_div_33_ng_template_2_Template, 21, 0, \"ng-template\", 21);\n    i0.ɵɵtemplate(3, NotaCreditoSinFacturaComponent_div_33_ng_template_3_Template, 22, 11, \"ng-template\", 22);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"value\", ctx_r3.listResponse)(\"tableStyle\", i0.ɵɵpureFunction0(2, _c1));\n  }\n}\n\nfunction NotaCreditoSinFacturaComponent_div_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"p-message\", 36);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"text\", ctx_r4.errorMEssageFile);\n  }\n}\n\nfunction NotaCreditoSinFacturaComponent_ng_template_39_th_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 39)(1, \"div\", 40);\n    i0.ɵɵtext(2);\n    i0.ɵɵelement(3, \"p-sortIcon\", 41);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const val_r17 = ctx.$implicit;\n    i0.ɵɵproperty(\"pSortableColumn\", val_r17.key);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", val_r17.label, \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"field\", val_r17.key);\n  }\n}\n\nfunction NotaCreditoSinFacturaComponent_ng_template_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵtemplate(1, NotaCreditoSinFacturaComponent_ng_template_39_th_1_Template, 4, 3, \"th\", 37);\n    i0.ɵɵelementStart(2, \"th\", 38);\n    i0.ɵɵtext(3, \" Opciones \");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r5.getHeadersTabla());\n  }\n}\n\nfunction NotaCreditoSinFacturaComponent_ng_template_40_div_32_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r22 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\")(1, \"p-button\", 45);\n    i0.ɵɵlistener(\"click\", function NotaCreditoSinFacturaComponent_ng_template_40_div_32_Template_p_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r22);\n      const bus_r18 = i0.ɵɵnextContext().$implicit;\n      const ctx_r20 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r20.cancelarComplemento(bus_r18.chuuid_nota_credito));\n    });\n    i0.ɵɵelement(2, \"i\", 46);\n    i0.ɵɵelementEnd()();\n  }\n}\n\nconst _c2 = function (a0) {\n  return {\n    \"invalid-tr\": a0\n  };\n};\n\nfunction NotaCreditoSinFacturaComponent_ng_template_40_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\", 42)(1, \"td\")(2, \"div\", 43);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵpipe(10, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵpipe(13, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"td\");\n    i0.ɵɵtext(15);\n    i0.ɵɵpipe(16, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"td\")(18, \"div\", 44);\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(20, \"td\");\n    i0.ɵɵtext(21);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"td\");\n    i0.ɵɵtext(23);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"td\");\n    i0.ɵɵtext(25);\n    i0.ɵɵpipe(26, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"td\");\n    i0.ɵɵtext(28);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"td\");\n    i0.ɵɵtext(30);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(31, \"td\");\n    i0.ɵɵtemplate(32, NotaCreditoSinFacturaComponent_ng_template_40_div_32_Template, 3, 0, \"div\", 16);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const bus_r18 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(23, _c2, bus_r18.dtfecha_cancelacion));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(bus_r18.chuuid_nota_credito);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(bus_r18.nunum_proyecto);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(bus_r18.nukidmoneda);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(10, 14, bus_r18.nuimporte));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(13, 16, bus_r18.nuiva));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(16, 18, bus_r18.nutotal));\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(bus_r18.chconcepto);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(bus_r18.numes);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(bus_r18.nuanio);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(26, 20, bus_r18.dtfecha_cancelacion, \"d/MM/yyyy\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(bus_r18.nutipo_cambio);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(bus_r18.chmotivocancela);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", bus_r18.dtfecha_cancelacion == null || bus_r18.dtfecha_cancelacion == \"\");\n  }\n}\n\nfunction NotaCreditoSinFacturaComponent_div_48_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"small\", 47);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r7.obtenerMensajeError(\"fecha_cancelacion\"), \" \");\n  }\n}\n\nfunction NotaCreditoSinFacturaComponent_div_53_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"small\", 47);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r8.obtenerMensajeError(\"motivo_cancelacion\"), \" \");\n  }\n}\n\nconst _c3 = function () {\n  return {\n    width: \"100%\"\n  };\n};\n\nconst _c4 = function () {\n  return {\n    width: \"50vw\",\n    minHeight: \"30rem\"\n  };\n};\n\nconst _c5 = function (a0) {\n  return {\n    \"ng-invalid ng-dirty\": a0\n  };\n};\n\nexport class NotaCreditoSinFacturaComponent {\n  constructor() {\n    this.cargaFileServ = inject(FacturacionService);\n    this.messageService = inject(MessageService);\n    this.timesheetService = inject(TimesheetService);\n    this.sharedService = inject(SharedService);\n    this.fb = inject(FormBuilder);\n    this.isLoadingFacturas = false;\n    this.fileSizeMax = 1000000;\n    this.isClear = false;\n    this.strFileBase64 = '';\n    this.listFacturasBase64 = new Array();\n    this.infoProyecto = new InfoProyecto();\n    this.errorMEssageFile = '';\n    this.proyectos = [];\n    this.complementoInfo = {\n      esPago: false,\n      titulo: '',\n      showModal: false\n    };\n    this.proyectoBusqueda = null;\n    this.mesSeleccionado = null;\n    this.anioSeleccionado = null;\n    this.listBusquedaCompleto = [];\n    this.form = this.fb.group({\n      uuid: [''],\n      fecha_cancelacion: ['', Validators.required],\n      motivo_cancelacion: ['', [Validators.required, Validators.minLength(20)]]\n    });\n  }\n\n  ngOnInit() {\n    this.sharedService.cambiarEstado(true);\n    forkJoin([this.timesheetService.getCatProyectos(), this.cargaFileServ.obtenerNotasSinFactura()]).pipe(finalize(() => this.sharedService.cambiarEstado(false))).subscribe({\n      next: data => {\n        const [proyectosR, notasCreditoR] = data;\n        this.proyectos = proyectosR.data.map(proyecto => ({\n          code: proyecto.numProyecto.toString(),\n          name: `${proyecto.numProyecto.toString()} - ${proyecto.nombre}`\n        }));\n        this.listBusquedaCompleto = notasCreditoR.data;\n      },\n      error: err => this.messageService.add({\n        severity: 'error',\n        summary: TITLES.error,\n        detail: err.error\n      })\n    });\n  }\n\n  buscarNotas() {\n    this.sharedService.cambiarEstado(true);\n    this.cargaFileServ.obtenerNotasSinFactura(this.proyectoBusqueda || 0, this.mesSeleccionado || 0, this.anioSeleccionado || 0).pipe(finalize(() => this.sharedService.cambiarEstado(false))).subscribe({\n      next: ({\n        data\n      }) => {\n        this.listBusquedaCompleto = data;\n      },\n      error: err => this.messageService.add({\n        severity: 'error',\n        summary: TITLES.error,\n        detail: err.error\n      })\n    });\n  }\n\n  buscarRegistros() {\n    if (this.mesBusqueda) {\n      this.mesSeleccionado = +format(this.mesBusqueda, 'M');\n      this.anioSeleccionado = +format(this.mesBusqueda, 'Y');\n    } else {\n      this.mesSeleccionado = null;\n      this.anioSeleccionado = null;\n    }\n\n    this.buscarNotas();\n  }\n\n  limpiarFiltros() {\n    this.mesBusqueda = null;\n    this.proyectoBusqueda = null;\n    this.mesSeleccionado = null;\n    this.anioSeleccionado = null;\n    this.buscarNotas();\n  }\n\n  getHeadersTabla() {\n    return [{\n      key: 'chuuid_nota_credito',\n      label: 'UUID'\n    }, {\n      key: 'nunum_proyecto',\n      label: 'Num Proyecto'\n    }, // 'ID Tipo Factura',\n    {\n      key: 'nukidmoneda',\n      label: 'ID Moneda'\n    }, {\n      key: 'nuimporte',\n      label: 'Importe'\n    }, {\n      key: 'nuiva',\n      label: 'Iva'\n    }, // 'IvaRet',\n    {\n      key: 'nutotal',\n      label: 'Total'\n    }, {\n      key: 'chconcepto',\n      label: 'Concepto'\n    }, {\n      key: 'numes',\n      label: 'Mes'\n    }, {\n      key: 'nuanio',\n      label: 'Año'\n    }, // 'Fecha Emision',\n    // 'Fecha Pago',\n    {\n      key: 'dtfecha_cancelacion',\n      label: 'Fecha Cancelacion'\n    }, // 'No Factura',\n    {\n      key: 'nutipo_cambio',\n      label: 'Tipo Cambio'\n    }, {\n      key: 'chmotivocancela',\n      label: 'Motivo Cancelacion'\n    }];\n  }\n\n  onBasicUpload(event) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (event && event.files) {\n        //console.log('length: ' + event.files.length);\n        _this.isLoadingFacturas = true;\n        yield _this.convertXML(event.files); //console.log(this.listFacturasBase64);\n\n        setTimeout(() => {\n          _this.cargaFile();\n        }, 3000);\n      }\n    })();\n  }\n\n  convertXML(files) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      return new Promise((resolve, reject) => {\n        let listFacturasBase64Sub = new Array();\n\n        for (let file of files) {\n          let reader = new FileReader();\n\n          reader.onload = evt => {\n            const xmlData = evt.target.result;\n            var parser = new DOMParser();\n            var xmlz = parser.parseFromString(xmlData, \"application/xml\");\n            _this2.strFileBase64 = window.btoa(new XMLSerializer().serializeToString(xmlz));\n            resolve(listFacturasBase64Sub);\n          };\n\n          reader.onerror = reject;\n          reader.readAsText(file);\n        }\n      });\n    })();\n  }\n\n  cargaFile() {\n    this.listResponse = new Array();\n\n    try {\n      const body = {\n        NumProyecto: this.idProyecto,\n        FacturaB64: this.strFileBase64\n      };\n      this.cargaFileServ.cargarNotaSinFactura(body).subscribe({\n        next: data => {\n          //console.log(data);\n          if (data.success) {\n            this.listResponse = data.data; //console.log(this.listResponse);\n\n            this.messageService.add({\n              severity: \"success\",\n              summary: \"Validar\",\n              detail: \"Nota procesada\",\n              life: 2000\n            });\n            this.clearFile();\n          }\n        },\n        error: e => {\n          //console.log(e);\n          let error = `${e.error}`;\n          this.messageService.add({\n            severity: \"error\",\n            summary: \"Error\",\n            detail: error,\n            life: 2000\n          });\n          this.errorMEssageFile = error;\n          this.clearFile(false);\n        }\n      });\n      this.isLoadingFacturas = false;\n      this.isClear = true;\n    } catch (err) {\n      console.log(err);\n      this.messageService.add({\n        severity: \"error\",\n        summary: \"Error\",\n        detail: String(err)\n      });\n    }\n  }\n\n  clearFile(exito = true) {\n    if (exito) {\n      this.idProyecto = null;\n    }\n\n    this.isClear = !this.isClear;\n    this.fileUpload.clear();\n    this.listResponse = new Array();\n    this.errorMEssageFile = '';\n    this.listFacturasBase64 = new Array();\n    this.listResponse = new Array();\n  }\n\n  exportJsonToExcel() {\n    const workbook = new ExcelJS.Workbook();\n    const worksheet = workbook.addWorksheet('Detalle'); // Encabezados\n\n    this._setXLSXHeader(worksheet); // Contenido\n\n\n    this._setXLSXContent(worksheet);\n\n    workbook.xlsx.writeBuffer().then(buffer => {\n      const blob = new Blob([buffer], {\n        type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n      });\n      saveAs(blob, `NotasCreditoSF_${Date.now()}${EXCEL_EXTENSION}`);\n    });\n  }\n\n  _setXLSXHeader(worksheet) {\n    const fill = {\n      type: 'pattern',\n      pattern: 'solid',\n      fgColor: {\n        argb: 'FF4681CB'\n      }\n    };\n    const alignment = {\n      vertical: 'middle',\n      horizontal: 'center',\n      wrapText: true\n    };\n    this.getHeadersTabla().forEach((encabezado, index) => {\n      let cell = worksheet.getCell(1, index + 1);\n      cell.value = encabezado.label;\n      cell.fill = fill;\n      cell.alignment = alignment;\n    });\n  }\n\n  _setXLSXContent(worksheet) {\n    let row = 2;\n    this.listBusquedaCompleto.forEach((nota, index) => {\n      worksheet.getCell(row + index, 1).value = nota.chuuid_nota_credito;\n      worksheet.getCell(row + index, 2).value = nota.nunum_proyecto;\n      worksheet.getCell(row + index, 3).value = nota.nukidmoneda;\n      worksheet.getCell(row + index, 4).value = nota.nuimporte;\n      worksheet.getCell(row + index, 5).value = nota.nuiva;\n      worksheet.getCell(row + index, 6).value = nota.nutotal;\n      worksheet.getCell(row + index, 7).value = nota.chconcepto;\n      worksheet.getCell(row + index, 8).value = nota.numes;\n      worksheet.getCell(row + index, 9).value = nota.nuanio;\n      worksheet.getCell(row + index, 10).value = nota.dtfecha_cancelacion;\n      worksheet.getCell(row + index, 11).value = nota.nutipo_cambio;\n      worksheet.getCell(row + index, 12).value = nota.chmotivocancela;\n    });\n  }\n\n  cancelarComplemento(uuid) {\n    this.complementoInfo = {\n      esPago: false,\n      titulo: 'Cancelar nota',\n      showModal: true\n    };\n    this.form.reset();\n    this.form.patchValue({\n      uuid\n    });\n  }\n\n  ejecutarCancelacion() {\n    if (!this.form.valid) {\n      this.form.markAllAsTouched();\n      return;\n    }\n\n    this.sharedService.cambiarEstado(true);\n    this.cargaFileServ.cancelarComplemento(this.complementoInfo.esPago, this.form.value).pipe(finalize(() => this.sharedService.cambiarEstado(false))).subscribe({\n      next: data => {\n        this.complementoInfo.showModal = false;\n        const indexFactura = this.listBusquedaCompleto.findIndex(factura => factura.chuuid_nota_credito === this.form.value.uuid);\n        this.listBusquedaCompleto.at(indexFactura).dtfecha_cancelacion = this.form.value.fecha_cancelacion;\n        this.listBusquedaCompleto.at(indexFactura).chmotivocancela = this.form.value.motivo_cancelacion;\n        this.messageService.add({\n          severity: 'success',\n          summary: TITLES.success,\n          detail: 'Se ha realizado la cancelación.'\n        });\n      },\n      error: err => this.messageService.add({\n        severity: 'error',\n        summary: TITLES.error,\n        detail: err.error\n      })\n    });\n  }\n\n  esInvalido(campo) {\n    return this.form.get(campo).invalid && (this.form.get(campo).dirty || this.form.get(campo).touched);\n  }\n\n  obtenerMensajeError(campo) {\n    let mensaje = '';\n    errorsArray.forEach(error => {\n      if (this.form.get(campo).hasError(error.tipo)) mensaje = error.mensaje.toString();\n    });\n    return mensaje;\n  }\n\n}\n\nNotaCreditoSinFacturaComponent.ɵfac = function NotaCreditoSinFacturaComponent_Factory(t) {\n  return new (t || NotaCreditoSinFacturaComponent)();\n};\n\nNotaCreditoSinFacturaComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: NotaCreditoSinFacturaComponent,\n  selectors: [[\"app-nota-credito-sin-factura\"]],\n  viewQuery: function NotaCreditoSinFacturaComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5);\n    }\n\n    if (rf & 2) {\n      let _t;\n\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.fileUpload = _t.first);\n    }\n  },\n  decls: 58,\n  vars: 59,\n  consts: [[1, \"main-container\"], [1, \"\"], [1, \"row\"], [1, \"col-4\"], [1, \"field\"], [\"for\", \"concepto\"], [\"id\", \"proyecto\", \"placeholder\", \"Seleccionar una proyecto\", \"optionLabel\", \"name\", \"optionValue\", \"code\", \"filterBy\", \"name\", 3, \"options\", \"showClear\", \"ngModel\", \"filter\", \"ngModelChange\"], [1, \"col-8\", \"d-flex\", \"align-items-center\", \"gap-4\"], [\"mode\", \"basic\", \"accept\", \".xml\", \"chooseLabel\", \"Cargar XML\", 3, \"customUpload\", \"multiple\", \"maxFileSize\", \"disabled\", \"onSelect\"], [\"fileUpload\", \"\"], [\"class\", \"field\", 4, \"ngIf\"], [\"icon\", \"pi pi-refresh\", \"label\", \"Limpiar carga\", 3, \"onClick\", 4, \"ngIf\"], [\"for\", \"proyecto\"], [\"placeholder\", \"Seleccionar una proyecto\", \"optionLabel\", \"name\", \"optionValue\", \"code\", \"filterBy\", \"name\", 3, \"options\", \"showClear\", \"filter\", \"ngModel\", \"onChange\", \"ngModelChange\"], [\"view\", \"month\", \"dateFormat\", \"m/yy\", \"placeholder\", \"Seleccionar un mes...\", 3, \"readonlyInput\", \"ngModel\", \"onSelect\", \"ngModelChange\"], [\"type\", \"button\", 1, \"btn\", \"btn-info\", 3, \"click\"], [4, \"ngIf\"], [\"styleClass\", \"p-1\"], [1, \"p-toolbar-group-start\"], [\"icon\", \"pi pi-file-excel\", \"pTooltip\", \"Exportar Excel\", \"styleClass\", \"p-button-success f-2x\", 3, \"click\"], [\"currentPageReportTemplate\", \"Total: {totalRecords}\", \"styleClass\", \"p-datatable-striped\", 3, \"value\", \"paginator\", \"rows\", \"showCurrentPageReport\", \"scrollable\", \"tableStyle\"], [\"pTemplate\", \"header\"], [\"pTemplate\", \"body\"], [3, \"header\", \"visible\", \"modal\", \"baseZIndex\", \"draggable\", \"resizable\", \"visibleChange\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"col-12\"], [\"for\", \"fecha_cancelacion\"], [\"id\", \"fecha_cancelacion\", \"dateFormat\", \"dd/mm/yy\", \"formControlName\", \"fecha_cancelacion\", 3, \"showIcon\", \"ngClass\"], [\"for\", \"motivo_cancelacion\"], [\"id\", \"motivo_cancelacion\", \"placeholder\", \"Ingrese al menos 20 caracteres\", \"pInputTextarea\", \"\", \"formControlName\", \"motivo_cancelacion\", 1, \"form-control\", 3, \"rows\", \"cols\", \"ngClass\"], [1, \"flex\", \"justify-content-end\", \"gap-3\", \"mt-3\"], [\"icon\", \"pi pi-check\", \"type\", \"submit\", \"label\", \"Aceptar\", 1, \"p-button-text\", 3, \"disabled\"], [\"icon\", \"pi pi-times\", \"label\", \"Cancelar\", 3, \"click\"], [1, \"pi\", \"pi-spin\", \"pi-spinner\", 2, \"font-size\", \"2rem\"], [\"icon\", \"pi pi-refresh\", \"label\", \"Limpiar carga\", 3, \"onClick\"], [\"styleClass\", \"p-datatable-striped\", 3, \"value\", \"tableStyle\"], [\"severity\", \"error\", 3, \"text\"], [3, \"pSortableColumn\", 4, \"ngFor\", \"ngForOf\"], [\"colspan\", \"3\", 1, \"text-center\"], [3, \"pSortableColumn\"], [1, \"d-flex\", \"align-items-center\"], [3, \"field\"], [3, \"ngClass\"], [1, \"cls-id\"], [1, \"cls-desc\"], [\"pTooltip\", \"Cancelar nota de cr\\u00E9dito\", \"styleClass\", \"p-button-rounded p-button-secondary p-button-text\", \"tooltipPosition\", \"left\", 3, \"click\"], [1, \"pi\", \"pi-times-circle\", \"text-2xl\"], [1, \"error-msg\"]],\n  template: function NotaCreditoSinFacturaComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4)(5, \"label\", 5);\n      i0.ɵɵtext(6, \"Proyecto:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(7, \"p-dropdown\", 6);\n      i0.ɵɵlistener(\"ngModelChange\", function NotaCreditoSinFacturaComponent_Template_p_dropdown_ngModelChange_7_listener($event) {\n        return ctx.idProyecto = $event;\n      });\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(8, \"div\", 7)(9, \"div\", 4)(10, \"label\", 5);\n      i0.ɵɵtext(11, \"Selecci\\u00F3n de Facturas:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(12, \"p-fileUpload\", 8, 9);\n      i0.ɵɵlistener(\"onSelect\", function NotaCreditoSinFacturaComponent_Template_p_fileUpload_onSelect_12_listener($event) {\n        return ctx.onBasicUpload($event);\n      });\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(14, NotaCreditoSinFacturaComponent_div_14_Template, 3, 0, \"div\", 10);\n      i0.ɵɵelementStart(15, \"div\", 4);\n      i0.ɵɵelement(16, \"br\");\n      i0.ɵɵtemplate(17, NotaCreditoSinFacturaComponent_p_button_17_Template, 1, 0, \"p-button\", 11);\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelement(18, \"br\");\n      i0.ɵɵelementStart(19, \"div\", 2)(20, \"div\", 3)(21, \"label\", 12);\n      i0.ɵɵtext(22, \"Proyecto:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(23, \"p-dropdown\", 13);\n      i0.ɵɵlistener(\"onChange\", function NotaCreditoSinFacturaComponent_Template_p_dropdown_onChange_23_listener() {\n        return ctx.buscarRegistros();\n      })(\"ngModelChange\", function NotaCreditoSinFacturaComponent_Template_p_dropdown_ngModelChange_23_listener($event) {\n        return ctx.proyectoBusqueda = $event;\n      });\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(24, \"div\", 3)(25, \"label\");\n      i0.ɵɵtext(26, \"Mes:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(27, \"p-calendar\", 14);\n      i0.ɵɵlistener(\"onSelect\", function NotaCreditoSinFacturaComponent_Template_p_calendar_onSelect_27_listener() {\n        return ctx.buscarRegistros();\n      })(\"ngModelChange\", function NotaCreditoSinFacturaComponent_Template_p_calendar_ngModelChange_27_listener($event) {\n        return ctx.mesBusqueda = $event;\n      });\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelement(28, \"div\", 3);\n      i0.ɵɵelementStart(29, \"div\", 3)(30, \"button\", 15);\n      i0.ɵɵlistener(\"click\", function NotaCreditoSinFacturaComponent_Template_button_click_30_listener() {\n        return ctx.limpiarFiltros();\n      });\n      i0.ɵɵtext(31, \"Limpiar filtros\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelement(32, \"br\");\n      i0.ɵɵtemplate(33, NotaCreditoSinFacturaComponent_div_33_Template, 4, 3, \"div\", 16);\n      i0.ɵɵtemplate(34, NotaCreditoSinFacturaComponent_div_34_Template, 2, 1, \"div\", 16);\n      i0.ɵɵelementStart(35, \"p-toolbar\", 17)(36, \"div\", 18)(37, \"p-button\", 19);\n      i0.ɵɵlistener(\"click\", function NotaCreditoSinFacturaComponent_Template_p_button_click_37_listener() {\n        return ctx.exportJsonToExcel();\n      });\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(38, \"p-table\", 20);\n      i0.ɵɵtemplate(39, NotaCreditoSinFacturaComponent_ng_template_39_Template, 4, 1, \"ng-template\", 21);\n      i0.ɵɵtemplate(40, NotaCreditoSinFacturaComponent_ng_template_40_Template, 33, 25, \"ng-template\", 22);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(41, \"p-dialog\", 23);\n      i0.ɵɵlistener(\"visibleChange\", function NotaCreditoSinFacturaComponent_Template_p_dialog_visibleChange_41_listener($event) {\n        return ctx.complementoInfo.showModal = $event;\n      });\n      i0.ɵɵelementStart(42, \"form\", 24);\n      i0.ɵɵlistener(\"ngSubmit\", function NotaCreditoSinFacturaComponent_Template_form_ngSubmit_42_listener() {\n        return ctx.ejecutarCancelacion();\n      });\n      i0.ɵɵelementStart(43, \"div\", 2)(44, \"div\", 25)(45, \"label\", 26);\n      i0.ɵɵtext(46, \"Fecha de cancelaci\\u00F3n:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(47, \"p-calendar\", 27);\n      i0.ɵɵtemplate(48, NotaCreditoSinFacturaComponent_div_48_Template, 3, 1, \"div\", 16);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(49, \"div\", 25)(50, \"label\", 28);\n      i0.ɵɵtext(51, \"Motivo:\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(52, \"textarea\", 29);\n      i0.ɵɵtemplate(53, NotaCreditoSinFacturaComponent_div_53_Template, 3, 1, \"div\", 16);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(54, \"div\", 30);\n      i0.ɵɵelement(55, \"p-button\", 31);\n      i0.ɵɵelementStart(56, \"p-button\", 32);\n      i0.ɵɵlistener(\"click\", function NotaCreditoSinFacturaComponent_Template_p_button_click_56_listener() {\n        return ctx.complementoInfo.showModal = false;\n      });\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelement(57, \"p-toast\");\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(7);\n      i0.ɵɵstyleMap(i0.ɵɵpureFunction0(49, _c3));\n      i0.ɵɵproperty(\"options\", ctx.proyectos)(\"showClear\", true)(\"ngModel\", ctx.idProyecto)(\"filter\", true);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"customUpload\", true)(\"multiple\", true)(\"maxFileSize\", ctx.fileSizeMax)(\"disabled\", !ctx.idProyecto);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.isLoadingFacturas);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngIf\", ctx.isClear);\n      i0.ɵɵadvance(6);\n      i0.ɵɵstyleMap(i0.ɵɵpureFunction0(50, _c3));\n      i0.ɵɵproperty(\"options\", ctx.proyectos)(\"showClear\", true)(\"filter\", true)(\"ngModel\", ctx.proyectoBusqueda);\n      i0.ɵɵadvance(4);\n      i0.ɵɵstyleMap(i0.ɵɵpureFunction0(51, _c3));\n      i0.ɵɵproperty(\"readonlyInput\", true)(\"ngModel\", ctx.mesBusqueda);\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"ngIf\", ctx.listResponse && ctx.listResponse.length > 0);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.errorMEssageFile != \"\");\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"value\", ctx.listBusquedaCompleto)(\"paginator\", true)(\"rows\", 5)(\"showCurrentPageReport\", true)(\"scrollable\", true)(\"tableStyle\", i0.ɵɵpureFunction0(52, _c1));\n      i0.ɵɵadvance(3);\n      i0.ɵɵstyleMap(i0.ɵɵpureFunction0(53, _c4));\n      i0.ɵɵproperty(\"header\", ctx.complementoInfo.titulo)(\"visible\", ctx.complementoInfo.showModal)(\"modal\", true)(\"baseZIndex\", 10000)(\"draggable\", false)(\"resizable\", false);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"formGroup\", ctx.form);\n      i0.ɵɵadvance(5);\n      i0.ɵɵstyleMap(i0.ɵɵpureFunction0(54, _c3));\n      i0.ɵɵproperty(\"showIcon\", true)(\"ngClass\", i0.ɵɵpureFunction1(55, _c5, ctx.esInvalido(\"fecha_cancelacion\")));\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.esInvalido(\"fecha_cancelacion\"));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"rows\", 3)(\"cols\", 80)(\"ngClass\", i0.ɵɵpureFunction1(57, _c5, ctx.esInvalido(\"motivo_cancelacion\")));\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.esInvalido(\"motivo_cancelacion\"));\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"disabled\", !ctx.form.valid);\n    }\n  },\n  dependencies: [i1.NgClass, i1.NgForOf, i1.NgIf, i2.ɵNgNoValidate, i2.DefaultValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.NgModel, i3.Tooltip, i4.PrimeTemplate, i5.Button, i6.Toolbar, i7.FileUpload, i8.Toast, i9.Table, i9.SortableColumn, i9.SortIcon, i10.UIMessage, i11.Dropdown, i12.Calendar, i13.Dialog, i14.InputTextarea, i2.FormGroupDirective, i2.FormControlName, i1.CurrencyPipe, i1.DatePipe],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJub3RhLWNyZWRpdG8tc2luLWZhY3R1cmEuY29tcG9uZW50LmNzcyJ9 */\"]\n});","map":{"version":3,"mappings":"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","names":["inject","FacturacionService","MessageService","InfoProyecto","LstFacturas","NotaCreditoSF","ResponseXML","TimesheetService","SharedService","finalize","forkJoin","EXCEL_EXTENSION","TITLES","errorsArray","ExcelJS","saveAs","FormBuilder","Validators","format","i0","NotaCreditoSinFacturaComponent","constructor","Array","esPago","titulo","showModal","fb","group","uuid","fecha_cancelacion","required","motivo_cancelacion","minLength","ngOnInit","sharedService","cambiarEstado","timesheetService","getCatProyectos","cargaFileServ","obtenerNotasSinFactura","pipe","subscribe","next","data","proyectosR","notasCreditoR","proyectos","map","proyecto","code","numProyecto","toString","name","nombre","listBusquedaCompleto","error","err","messageService","add","severity","summary","detail","buscarNotas","proyectoBusqueda","mesSeleccionado","anioSeleccionado","buscarRegistros","mesBusqueda","limpiarFiltros","getHeadersTabla","key","label","onBasicUpload","event","files","isLoadingFacturas","convertXML","setTimeout","cargaFile","Promise","resolve","reject","listFacturasBase64Sub","file","reader","FileReader","onload","evt","xmlData","target","result","parser","DOMParser","xmlz","parseFromString","strFileBase64","window","btoa","XMLSerializer","serializeToString","onerror","readAsText","listResponse","body","NumProyecto","idProyecto","FacturaB64","cargarNotaSinFactura","success","life","clearFile","e","errorMEssageFile","isClear","console","log","String","exito","fileUpload","clear","listFacturasBase64","exportJsonToExcel","workbook","Workbook","worksheet","addWorksheet","_setXLSXHeader","_setXLSXContent","xlsx","writeBuffer","then","buffer","blob","Blob","type","Date","now","fill","pattern","fgColor","argb","alignment","vertical","horizontal","wrapText","forEach","encabezado","index","cell","getCell","value","row","nota","chuuid_nota_credito","nunum_proyecto","nukidmoneda","nuimporte","nuiva","nutotal","chconcepto","numes","nuanio","dtfecha_cancelacion","nutipo_cambio","chmotivocancela","cancelarComplemento","complementoInfo","form","reset","patchValue","ejecutarCancelacion","valid","markAllAsTouched","indexFactura","findIndex","factura","at","esInvalido","campo","get","invalid","dirty","touched","obtenerMensajeError","mensaje","hasError","tipo","selectors","viewQuery","ctx"],"sourceRoot":"","sources":["F:\\Bovis\\Front\\bovis-dev\\src\\app\\facturacion\\components\\nota-credito-sin-factura\\nota-credito-sin-factura.component.ts","F:\\Bovis\\Front\\bovis-dev\\src\\app\\facturacion\\components\\nota-credito-sin-factura\\nota-credito-sin-factura.component.html"],"sourcesContent":["import { Component, OnInit, ViewChild, inject } from '@angular/core';\r\nimport { FacturacionService } from '../../services/facturacion.service';\r\nimport { MessageService } from 'primeng/api';\r\nimport { FacrurasNC, InfoProyecto, LstFacturas, NotaCreditoSF, ResponseXML } from '../../Models/FacturacionModels';\r\nimport { Opcion } from 'src/models/general.model';\r\nimport { TimesheetService } from 'src/app/timesheet/services/timesheet.service';\r\nimport { SharedService } from 'src/app/shared/services/shared.service';\r\nimport { finalize, forkJoin } from 'rxjs';\r\nimport { EXCEL_EXTENSION, TITLES, errorsArray } from 'src/utils/constants';\r\n\r\nimport * as ExcelJS from 'exceljs';\r\nimport { saveAs } from 'file-saver';\r\nimport { FormBuilder, Validators } from '@angular/forms';\r\nimport { format } from 'date-fns';\r\n\r\n@Component({\r\n  selector: 'app-nota-credito-sin-factura',\r\n  templateUrl: './nota-credito-sin-factura.component.html',\r\n  styleUrls: ['./nota-credito-sin-factura.component.css']\r\n})\r\nexport class NotaCreditoSinFacturaComponent implements OnInit {\r\n\r\n  cargaFileServ     = inject(FacturacionService)\r\n  messageService    = inject(MessageService)\r\n  timesheetService  = inject(TimesheetService)\r\n  sharedService     = inject(SharedService)\r\n  fb                = inject(FormBuilder)\r\n\r\n  isLoadingFacturas: boolean = false;\r\n  fileSizeMax = 1000000;\r\n  isClear: boolean = false;\r\n  strFileBase64: string = '';\r\n  listFacturasBase64: Array<LstFacturas> = new Array<LstFacturas>();\r\n  infoProyecto: InfoProyecto = new InfoProyecto();\r\n  @ViewChild('fileUpload') fileUpload: any;\r\n  listResponse: Array<ResponseXML>;\r\n  errorMEssageFile: string = '';\r\n  proyectos: Opcion[] = []\r\n  idProyecto: number\r\n  facturaBase64: string\r\n  complementoInfo: any = {\r\n    esPago:     false,\r\n    titulo:     '',\r\n    showModal:  false\r\n  }\r\n  proyectoBusqueda: number = null\r\n  mesBusqueda: Date\r\n  mesSeleccionado: number = null\r\n  anioSeleccionado: number = null\r\n\r\n  listBusquedaCompleto: NotaCreditoSF[] = []\r\n  \r\n  form = this.fb.group({\r\n    uuid:               [''],\r\n    fecha_cancelacion:  ['', Validators.required],\r\n    motivo_cancelacion: ['', [Validators.required, Validators.minLength(20)]]\r\n  })\r\n  \r\n  constructor() { }\r\n\r\n  ngOnInit(): void {\r\n\r\n    this.sharedService.cambiarEstado(true)\r\n\r\n    forkJoin([\r\n      this.timesheetService.getCatProyectos(),\r\n      this.cargaFileServ.obtenerNotasSinFactura()\r\n    ])\r\n      .pipe(finalize(() => this.sharedService.cambiarEstado(false)))\r\n      .subscribe({\r\n        next: (data) => {\r\n          const [proyectosR, notasCreditoR] = data\r\n          this.proyectos = proyectosR.data.map(proyecto => ({code: proyecto.numProyecto.toString(), name: `${proyecto.numProyecto.toString()} - ${proyecto.nombre}`}))\r\n          this.listBusquedaCompleto = notasCreditoR.data\r\n        },\r\n        error: (err) => this.messageService.add({severity: 'error', summary: TITLES.error, detail: err.error})\r\n      })\r\n  }\r\n\r\n  buscarNotas() {\r\n    \r\n    this.sharedService.cambiarEstado(true)\r\n\r\n      this.cargaFileServ.obtenerNotasSinFactura(this.proyectoBusqueda || 0, this.mesSeleccionado || 0, this.anioSeleccionado || 0)\r\n      .pipe(finalize(() => this.sharedService.cambiarEstado(false)))\r\n      .subscribe({\r\n        next: ({data}) => {\r\n          this.listBusquedaCompleto = data\r\n        },\r\n        error: (err) => this.messageService.add({severity: 'error', summary: TITLES.error, detail: err.error})\r\n      })\r\n  }\r\n\r\n  buscarRegistros() {\r\n\r\n    if(this.mesBusqueda) {\r\n      this.mesSeleccionado   = +format(this.mesBusqueda, 'M')\r\n      this.anioSeleccionado  = +format(this.mesBusqueda, 'Y')\r\n    } else {\r\n      this.mesSeleccionado   = null\r\n      this.anioSeleccionado  = null\r\n    }\r\n\r\n    this.buscarNotas()\r\n  }\r\n\r\n  limpiarFiltros() {\r\n    this.mesBusqueda = null\r\n    this.proyectoBusqueda = null\r\n    this.mesSeleccionado = null\r\n    this.anioSeleccionado = null\r\n\r\n    this.buscarNotas()\r\n  }\r\n\r\n  getHeadersTabla() {\r\n    return [\r\n      {key: 'chuuid_nota_credito', label: 'UUID'},\r\n      {key: 'nunum_proyecto', label: 'Num Proyecto'},\r\n      // 'ID Tipo Factura',\r\n      {key: 'nukidmoneda', label: 'ID Moneda'},\r\n      {key: 'nuimporte', label: 'Importe'},\r\n      {key: 'nuiva', label: 'Iva'},\r\n      // 'IvaRet',\r\n      {key: 'nutotal', label: 'Total'},\r\n      {key: 'chconcepto', label: 'Concepto'},\r\n      {key: 'numes', label: 'Mes'},\r\n      {key: 'nuanio', label: 'Año'},\r\n      // 'Fecha Emision',\r\n      // 'Fecha Pago',\r\n      {key: 'dtfecha_cancelacion', label: 'Fecha Cancelacion'},\r\n      // 'No Factura',\r\n      {key: 'nutipo_cambio', label: 'Tipo Cambio'},\r\n      {key: 'chmotivocancela', label: 'Motivo Cancelacion'}\r\n    ];\r\n  }\r\n\r\n  async onBasicUpload(event: any) {\r\n    if (event && event.files) {\r\n      //console.log('length: ' + event.files.length);\r\n      this.isLoadingFacturas = true;\r\n      await this.convertXML(event.files)\r\n      //console.log(this.listFacturasBase64);\r\n\r\n      setTimeout(\r\n        ()=>{\r\n        this.cargaFile()\r\n      },3000);\r\n    }\r\n  }\r\n\r\n  async convertXML(files: any) {\r\n    return new Promise((resolve, reject) => {\r\n      let listFacturasBase64Sub: Array<LstFacturas> = new Array<LstFacturas>();\r\n      for (let file of files) {\r\n        let reader = new FileReader();\r\n        reader.onload = (evt) => {\r\n          const xmlData: string = (evt as any).target.result;\r\n          var parser = new DOMParser();\r\n          var xmlz = parser.parseFromString(xmlData, \"application/xml\");\r\n          this.strFileBase64 = window.btoa((new XMLSerializer()).serializeToString(xmlz));\r\n          resolve(listFacturasBase64Sub);\r\n        };\r\n        reader.onerror = reject;\r\n        reader.readAsText(file);\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n  cargaFile() {\r\n\r\n    this.listResponse = new Array<ResponseXML>();\r\n    try {\r\n      const body = {\r\n        NumProyecto: this.idProyecto,\r\n        FacturaB64: this.strFileBase64\r\n      }\r\n      this.cargaFileServ.cargarNotaSinFactura(body).subscribe({\r\n        next: (data) => {\r\n          //console.log(data);\r\n          if (data.success) {\r\n            this.listResponse = data.data;\r\n            //console.log(this.listResponse);\r\n            this.messageService.add({\r\n              severity: \"success\",\r\n              summary: \"Validar\",\r\n              detail: \"Nota procesada\",\r\n              life: 2000\r\n            });\r\n\r\n            this.clearFile()\r\n          }\r\n        },\r\n        error: (e) => {\r\n          //console.log(e);\r\n          let error = `${e.error}`\r\n          this.messageService.add({\r\n            severity: \"error\",\r\n            summary: \"Error\",\r\n            detail: error,\r\n            life: 2000\r\n          });\r\n\r\n          this.errorMEssageFile = error;\r\n\r\n          this.clearFile(false)\r\n        }\r\n\r\n      })\r\n      this.isLoadingFacturas = false;\r\n      this.isClear = true;\r\n    } catch (err) {\r\n      console.log(err);\r\n      this.messageService.add({\r\n        severity: \"error\",\r\n        summary: \"Error\",\r\n        detail: String(err)\r\n      });\r\n    }\r\n\r\n  }\r\n\r\n  clearFile(exito: boolean = true) {\r\n    if(exito) {\r\n      this.idProyecto = null\r\n    }\r\n    this.isClear = !this.isClear\r\n    this.fileUpload.clear();\r\n    this.listResponse = new Array<ResponseXML>();\r\n    this.errorMEssageFile = '';\r\n    this.listFacturasBase64 = new Array<LstFacturas>();\r\n    this.listResponse = new Array<ResponseXML>();\r\n  }\r\n\r\n  exportJsonToExcel() {\r\n\r\n    const workbook = new ExcelJS.Workbook()\r\n\r\n    const worksheet = workbook.addWorksheet('Detalle')\r\n\r\n    // Encabezados\r\n    this._setXLSXHeader(worksheet)\r\n\r\n    // Contenido\r\n    this._setXLSXContent(worksheet)\r\n\r\n    workbook.xlsx.writeBuffer().then((buffer) => {\r\n      const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' })\r\n\r\n      saveAs(blob, `NotasCreditoSF_${Date.now()}${EXCEL_EXTENSION}`)\r\n    });\r\n  }\r\n\r\n  _setXLSXHeader(worksheet: ExcelJS.Worksheet) {\r\n    \r\n    const fill: ExcelJS.Fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: 'FF4681CB' } }\r\n    const alignment: Partial<ExcelJS.Alignment> = { vertical: 'middle', horizontal: 'center', wrapText: true }\r\n\r\n    this.getHeadersTabla().forEach((encabezado, index) => {\r\n      let cell = worksheet.getCell(1, index + 1)\r\n      cell.value = encabezado.label\r\n      cell.fill = fill\r\n      cell.alignment = alignment\r\n    })\r\n  }\r\n\r\n  _setXLSXContent(worksheet: ExcelJS.Worksheet) {\r\n\r\n    let row = 2\r\n    this.listBusquedaCompleto.forEach((nota, index) => {\r\n      worksheet.getCell(row + index, 1).value = nota.chuuid_nota_credito\r\n      worksheet.getCell(row + index, 2).value = nota.nunum_proyecto \r\n      worksheet.getCell(row + index, 3).value = nota.nukidmoneda\r\n      worksheet.getCell(row + index, 4).value = nota.nuimporte\r\n      worksheet.getCell(row + index, 5).value = nota.nuiva\r\n      worksheet.getCell(row + index, 6).value = nota.nutotal\r\n      worksheet.getCell(row + index, 7).value = nota.chconcepto\r\n      worksheet.getCell(row + index, 8).value = nota.numes \r\n      worksheet.getCell(row + index, 9).value = nota.nuanio\r\n      worksheet.getCell(row + index, 10).value = nota.dtfecha_cancelacion\r\n      worksheet.getCell(row + index, 11).value = nota.nutipo_cambio\r\n      worksheet.getCell(row + index, 12).value = nota.chmotivocancela\r\n    })\r\n  }\r\n  \r\n  cancelarComplemento(uuid: string) {\r\n    this.complementoInfo = {\r\n      esPago: false,\r\n      titulo: 'Cancelar nota',\r\n      showModal: true\r\n    }\r\n    this.form.reset()\r\n    this.form.patchValue({uuid})\r\n  }\r\n  \r\n  ejecutarCancelacion() {\r\n    \r\n    if(!this.form.valid) {\r\n      this.form.markAllAsTouched()\r\n      return\r\n    }\r\n\r\n    this.sharedService.cambiarEstado(true)\r\n\r\n    this.cargaFileServ.cancelarComplemento(this.complementoInfo.esPago, this.form.value)\r\n      .pipe(finalize(() => this.sharedService.cambiarEstado(false)))\r\n      .subscribe({\r\n        next: (data) => {\r\n          this.complementoInfo.showModal = false\r\n\r\n          const indexFactura = this.listBusquedaCompleto.findIndex(factura => factura.chuuid_nota_credito === this.form.value.uuid)\r\n          this.listBusquedaCompleto.at(indexFactura).dtfecha_cancelacion = this.form.value.fecha_cancelacion\r\n          this.listBusquedaCompleto.at(indexFactura).chmotivocancela = this.form.value.motivo_cancelacion\r\n\r\n          this.messageService.add({ severity: 'success', summary: TITLES.success, detail: 'Se ha realizado la cancelación.' })\r\n        },\r\n        error: (err) => this.messageService.add({ severity: 'error', summary: TITLES.error, detail: err.error })\r\n      })\r\n  }\r\n\r\n  esInvalido(campo: string): boolean {\r\n    return this.form.get(campo).invalid && \r\n            (this.form.get(campo).dirty || this.form.get(campo).touched)\r\n  }\r\n\r\n  obtenerMensajeError(campo: string): string {\r\n    let mensaje = ''\r\n\r\n    errorsArray.forEach((error) => {\r\n      if(this.form.get(campo).hasError(error.tipo))\r\n        mensaje = error.mensaje.toString()\r\n    })\r\n\r\n    return mensaje\r\n  }\r\n\r\n}\r\n","<div class=\"main-container\">\r\n\r\n    <div class=\"\">\r\n  \r\n      <div class=\"row\">\r\n        \r\n        <div class=\"col-4\">\r\n            <div class=\"field\">\r\n                <label for=\"concepto\">Proyecto:</label>\r\n                <p-dropdown \r\n                  id=\"proyecto\" \r\n                  [options]=\"proyectos\"\r\n                  placeholder=\"Seleccionar una proyecto\" \r\n                  optionLabel=\"name\"\r\n                  [showClear]=\"true\"\r\n                  [style]=\"{ width: '100%' }\"\r\n                  [(ngModel)]=\"idProyecto\"\r\n                  optionValue=\"code\"\r\n                  [filter]=\"true\" \r\n                  filterBy=\"name\"\r\n                ></p-dropdown>\r\n            </div>\r\n        </div>\r\n  \r\n        <div class=\"col-8 d-flex align-items-center gap-4\">\r\n            <div class=\"field\">\r\n              <label for=\"concepto\">Selección de Facturas:</label>\r\n              <p-fileUpload #fileUpload mode=\"basic\" [customUpload]=\"true\" accept=\".xml\" (onSelect)=\"onBasicUpload($event)\"\r\n                [multiple]=\"true\" [maxFileSize]=\"fileSizeMax\" chooseLabel=\"Cargar XML\" [disabled]=\"!idProyecto\"></p-fileUpload>\r\n            </div>\r\n            <div class=\"field\" *ngIf=\"isLoadingFacturas\">\r\n              <br>\r\n              <i class=\"pi pi-spin pi-spinner\" style=\"font-size: 2rem\"></i>\r\n            </div>\r\n            <div class=\"field\">\r\n              <br>\r\n              <p-button *ngIf=\"isClear\" icon=\"pi pi-refresh\" (onClick)=\"clearFile()\" label=\"Limpiar carga\"></p-button>\r\n            </div>\r\n        </div>\r\n  \r\n  \r\n      </div>\r\n    </div>\r\n    <br>\r\n    \r\n    <div class=\"row\">\r\n      <div class=\"col-4\">\r\n        <label for=\"proyecto\">Proyecto:</label>\r\n        <p-dropdown  \r\n          [options]=\"proyectos\"\r\n          placeholder=\"Seleccionar una proyecto\" \r\n          optionLabel=\"name\"\r\n          [showClear]=\"true\"\r\n          [style]=\"{ width: '100%' }\"\r\n          optionValue=\"code\"\r\n          [filter]=\"true\" \r\n          filterBy=\"name\"\r\n          (onChange)=\"buscarRegistros()\"\r\n          [(ngModel)]=\"proyectoBusqueda\"\r\n        ></p-dropdown>\r\n      </div>\r\n      <div class=\"col-4\">\r\n          <label>Mes:</label>\r\n          <p-calendar \r\n            view=\"month\" \r\n            dateFormat=\"m/yy\" \r\n            [readonlyInput]=\"true\" \r\n            (onSelect)=\"buscarRegistros()\"\r\n            [style]=\"{width: '100%'}\"\r\n            placeholder=\"Seleccionar un mes...\"\r\n            [(ngModel)]=\"mesBusqueda\"\r\n          ></p-calendar>\r\n      </div>\r\n      <div class=\"col-4\"></div>\r\n      <div class=\"col-4\">\r\n        <button type=\"button\" class=\"btn btn-info\" (click)=\"limpiarFiltros()\">Limpiar filtros</button>\r\n      </div>\r\n    </div>\r\n\r\n    <br>\r\n  \r\n    <div *ngIf=\"listResponse && listResponse.length > 0\">\r\n      <p-table [value]=\"listResponse\" styleClass=\"p-datatable-striped\" [tableStyle]=\"{'min-width': '50rem'}\">\r\n        <ng-template pTemplate=\"header\">\r\n          <tr>\r\n            <th>Conceptos</th>\r\n            <th>Rfc Emisor</th>\r\n            <th>Rfc Receptor</th>\r\n            <th>Fecha</th>\r\n            <th>Total</th>\r\n            <th>Tipo Factura</th>\r\n            <th>No. Factura</th>\r\n            <th>Nombre Factura</th>\r\n            <th>Almacenada</th>\r\n            <th>Error</th>\r\n          </tr>\r\n        </ng-template>\r\n        <ng-template pTemplate=\"body\" let-xml>\r\n          <tr>\r\n            <td>\r\n              {{xml.conceptos}}\r\n            </td>\r\n            <td>{{xml.rfcEmisor}}</td>\r\n            <td>{{xml.rfcReceptor}}</td>\r\n            <td>{{xml.fechaEmision}}</td>\r\n            <td>{{xml.total}}</td>\r\n            <td>{{xml.tipoFactura}}</td>\r\n            <td>{{xml.noFactura}}</td>\r\n            <td>{{xml.facturaNombre}}</td>\r\n            <td>\r\n              <ng-container *ngIf=\"xml.almacenada\">\r\n                Si\r\n              </ng-container>\r\n              <ng-container *ngIf=\"!xml.almacenada\">\r\n                No\r\n              </ng-container>\r\n  \r\n            </td>\r\n            <td>{{xml.error}}</td>\r\n          </tr>\r\n        </ng-template>\r\n      </p-table>\r\n    </div>\r\n  \r\n    <div *ngIf=\"errorMEssageFile != ''\">\r\n      <p-message severity=\"error\" [text]=\"errorMEssageFile\"></p-message>\r\n    </div>\r\n    \r\n    <p-toolbar styleClass=\"p-1\">\r\n      <div class=\"p-toolbar-group-start\">\r\n          <p-button\r\n            icon=\"pi pi-file-excel\" \r\n            pTooltip=\"Exportar Excel\" \r\n            styleClass=\"p-button-success f-2x\" \r\n            (click)=\"exportJsonToExcel()\">\r\n          </p-button>\r\n      </div>\r\n    </p-toolbar>\r\n    <p-table\r\n      [value]=\"listBusquedaCompleto\" \r\n      [paginator]=\"true\"\r\n      [rows]=\"5\"\r\n      [showCurrentPageReport]=\"true\"\r\n      currentPageReportTemplate=\"Total: {totalRecords}\"\r\n      styleClass=\"p-datatable-striped\" \r\n      [scrollable]=\"true\"\r\n      [tableStyle]=\"{ 'min-width': '50rem' }\">\r\n      <ng-template pTemplate=\"header\">\r\n        <tr>\r\n          <!-- <th *ngFor=\"let val of getHeadersTabla()\">{{val}}</th> -->\r\n          <th *ngFor=\"let val of getHeadersTabla()\" [pSortableColumn]=\"val.key\"><div class=\"d-flex align-items-center\">{{val.label}} <p-sortIcon [field]=\"val.key\"></p-sortIcon></div></th>\r\n          <th \r\n            colspan=\"3\" \r\n            class=\"text-center\"\r\n          >\r\n            Opciones\r\n          </th>\r\n        </tr>\r\n      </ng-template>\r\n      <ng-template pTemplate=\"body\" let-bus>\r\n        <tr [ngClass]=\"{'invalid-tr': bus.dtfecha_cancelacion}\">\r\n          <td>\r\n            <div class=\"cls-id\">{{bus.chuuid_nota_credito}}</div>\r\n          </td>\r\n          <td>{{bus.nunum_proyecto}}</td>\r\n          <td>{{bus.nukidmoneda}}</td>\r\n          <td>{{bus.nuimporte|currency}}</td>\r\n          <td>{{bus.nuiva|currency}}</td>\r\n          <!-- <td>{{bus.ivaRet|currency}}</td> -->\r\n          <td>{{bus.nutotal|currency}}</td>\r\n          <td>\r\n            <div class=\"cls-desc\">{{bus.chconcepto}}</div>\r\n          </td>\r\n          <td>{{bus.numes}}</td>\r\n          <td>{{bus.nuanio}}</td>\r\n          <td>{{bus.dtfecha_cancelacion|date:'d/MM/yyyy'}}</td>\r\n          <td>{{bus.nutipo_cambio}}</td>\r\n          <td>{{bus.chmotivocancela}}</td>\r\n          <td>\r\n            <div *ngIf=\"bus.dtfecha_cancelacion == null || bus.dtfecha_cancelacion == '' \">\r\n              <!-- <i class=\"pi pi-trash c-del\" title=\"Cancelar factura\"\r\n              tooltipPosition=\"left\" (click)=\"showModalDialog(bus.id)\"></i> -->\r\n              <p-button \r\n                pTooltip=\"Cancelar nota de crédito\" \r\n                styleClass=\"p-button-rounded p-button-secondary p-button-text\"\r\n                tooltipPosition=\"left\"\r\n                (click)=\"cancelarComplemento(bus.chuuid_nota_credito)\"\r\n              >\r\n                <i class=\"pi pi-times-circle text-2xl\"></i>\r\n              </p-button>\r\n            </div>\r\n          </td>\r\n        </tr>\r\n      </ng-template>\r\n    </p-table>\r\n  \r\n</div>\r\n\r\n<!-- Modal para cancelar complemento -->\r\n<p-dialog \r\n  [header]=\"complementoInfo.titulo\" \r\n  [(visible)]=\"complementoInfo.showModal\" \r\n  [modal]=\"true\" \r\n  [style]=\"{width: '50vw', minHeight: '30rem'}\" \r\n  [baseZIndex]=\"10000\"\r\n  [draggable]=\"false\" \r\n  [resizable]=\"false\"\r\n>\r\n  <form [formGroup]=\"form\" (ngSubmit)=\"ejecutarCancelacion()\">\r\n    <div class=\"row\">\r\n      <div class=\"col-12\">\r\n        <label for=\"fecha_cancelacion\">Fecha de cancelación:</label>\r\n        <p-calendar \r\n          id=\"fecha_cancelacion\"\r\n          [showIcon]=\"true\"\r\n          dateFormat=\"dd/mm/yy\"\r\n          [style]=\"{ width: '100%' }\"\r\n          [ngClass]=\"{'ng-invalid ng-dirty': esInvalido('fecha_cancelacion')}\"\r\n          formControlName=\"fecha_cancelacion\"\r\n        ></p-calendar>\r\n        <div *ngIf=\"esInvalido('fecha_cancelacion')\">\r\n          <small\r\n            class=\"error-msg\"\r\n          >\r\n            {{ obtenerMensajeError('fecha_cancelacion') }}\r\n          </small>\r\n        </div>\r\n      </div>\r\n      <div class=\"col-12\">\r\n        <label for=\"motivo_cancelacion\">Motivo:</label>\r\n        <textarea \r\n          id=\"motivo_cancelacion\"\r\n          placeholder=\"Ingrese al menos 20 caracteres\" \r\n          [rows]=\"3\" \r\n          [cols]=\"80\" \r\n          pInputTextarea  \r\n          class=\"form-control\"\r\n          [ngClass]=\"{'ng-invalid ng-dirty': esInvalido('motivo_cancelacion')}\"\r\n          formControlName=\"motivo_cancelacion\"\r\n        ></textarea>\r\n        <div *ngIf=\"esInvalido('motivo_cancelacion')\">\r\n          <small\r\n            class=\"error-msg\"\r\n          >\r\n            {{ obtenerMensajeError('motivo_cancelacion') }}\r\n          </small>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"flex justify-content-end gap-3 mt-3\">\r\n      <p-button \r\n        icon=\"pi pi-check\" \r\n        type=\"submit\"\r\n        label=\"Aceptar\" \r\n        class=\"p-button-text\" \r\n        [disabled]=\"!this.form.valid\"\r\n      ></p-button>\r\n      <p-button \r\n        icon=\"pi pi-times\" \r\n        (click)=\"complementoInfo.showModal = false\" \r\n        label=\"Cancelar\"\r\n      ></p-button>\r\n    </div>\r\n  </form>\r\n</p-dialog>\r\n  \r\n<p-toast></p-toast>\r\n  "]},"metadata":{},"sourceType":"module"}