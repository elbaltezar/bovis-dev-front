{"ast":null,"code":"import _asyncToGenerator from \"F:/Bovis/Front/bovis-dev/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { inject } from '@angular/core';\nimport { DynamicDialogConfig, DynamicDialogRef } from 'primeng/dynamicdialog';\nimport { AuditoriaService } from '../../services/auditoria.service';\nimport { descargarArchivo } from 'src/helpers/helpers';\nimport { MessageService } from 'primeng/api';\nimport { SUBJECTS, TITLES } from 'src/utils/constants';\nimport { FormBuilder } from '@angular/forms';\nimport { SharedService } from 'src/app/shared/services/shared.service';\nimport { finalize } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"primeng/api\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"primeng/inputswitch\";\nimport * as i4 from \"primeng/table\";\n\nfunction VerDocumentosComponent_ng_template_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"th\");\n    i0.ɵɵtext(2, \"Documento\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"th\", 8);\n    i0.ɵɵtext(4, \"V\\u00E1lido\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction VerDocumentosComponent_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\", 9)(1, \"td\")(2, \"a\", 10);\n    i0.ɵɵlistener(\"click\", function VerDocumentosComponent_ng_template_5_Template_a_click_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const documento_r2 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.descargarDocumento(documento_r2.value.id_documento));\n    });\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"td\", 8);\n    i0.ɵɵelement(5, \"p-inputSwitch\", 11);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const documento_r2 = ctx.$implicit;\n    const i_r3 = ctx.rowIndex;\n    i0.ɵɵproperty(\"formGroupName\", i_r3);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", documento_r2.value.fecha + \"_\" + documento_r2.value.id_documento.toString(), \" \");\n  }\n}\n\nconst _c0 = function () {\n  return {\n    \"min-width\": \"100%\"\n  };\n};\n\nexport class VerDocumentosComponent {\n  constructor() {\n    this.auditoriaService = inject(AuditoriaService);\n    this.config = inject(DynamicDialogConfig);\n    this.fb = inject(FormBuilder);\n    this.messageService = inject(MessageService);\n    this.ref = inject(DynamicDialogRef);\n    this.sharedService = inject(SharedService); // documentos: Documento[]\n\n    this.formDocumentos = this.fb.group({\n      data: this.fb.array([])\n    });\n  }\n\n  get documentos() {\n    return this.formDocumentos.get('data');\n  }\n\n  ngOnInit() {\n    var _a;\n\n    if ((_a = this.config.data) === null || _a === void 0 ? void 0 : _a.idAuditoria) {\n      this.auditoriaService.getDocumentos(this.config.data.idAuditoria).subscribe({\n        next: ({\n          data\n        }) => {\n          data.forEach(documento => {\n            this.documentos.push(this.fb.group({\n              fecha: [documento.fecha],\n              id_documento: [documento.idDocumento],\n              valido: [documento.valido]\n            }));\n          });\n        },\n        error: err => this.closeDialog()\n      });\n    } else {\n      this.closeDialog();\n    }\n  }\n\n  descargarDocumento(id) {\n    if (id != 0) {\n      this.auditoriaService.getDocumento(id).subscribe({\n        next: ({\n          data\n        }) => {\n          this.descargar(data.documentoBase64);\n        },\n        error: err => this.messageService.add({\n          severity: 'error',\n          summary: TITLES.error,\n          detail: SUBJECTS.error\n        })\n      });\n    }\n  }\n\n  descargar(base64) {\n    return _asyncToGenerator(function* () {\n      yield descargarArchivo(base64, `Documento_${Date.now()}`);\n    })();\n  }\n\n  closeDialog() {\n    this.ref.close();\n  }\n\n  guardar() {\n    this.sharedService.cambiarEstado(true);\n    this.auditoriaService.validarDocumentos(this.formDocumentos.value).pipe(finalize(() => this.sharedService.cambiarEstado(false))).subscribe({\n      next: data => {\n        this.ref.close({\n          exito: true\n        });\n      },\n      error: err => this.messageService.add({\n        severity: 'error',\n        summary: TITLES.error,\n        detail: err.error\n      })\n    });\n  }\n\n}\n\nVerDocumentosComponent.ɵfac = function VerDocumentosComponent_Factory(t) {\n  return new (t || VerDocumentosComponent)();\n};\n\nVerDocumentosComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: VerDocumentosComponent,\n  selectors: [[\"app-ver-documentos\"]],\n  features: [i0.ɵɵProvidersFeature([MessageService])],\n  decls: 9,\n  vars: 5,\n  consts: [[3, \"formGroup\"], [1, \"card\"], [\"formArrayName\", \"data\"], [3, \"value\", \"tableStyle\"], [\"pTemplate\", \"header\"], [\"pTemplate\", \"body\"], [1, \"d-flex\", \"justify-content-center\", \"mt-4\"], [\"type\", \"button\", 1, \"btn\", \"btn-info\", 3, \"disabled\", \"click\"], [1, \"text-center\"], [3, \"formGroupName\"], [1, \"text-success\", \"font-bold\", \"pointer\", 3, \"click\"], [\"formControlName\", \"valido\"]],\n  template: function VerDocumentosComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"form\", 0)(1, \"div\", 1);\n      i0.ɵɵelementContainerStart(2, 2);\n      i0.ɵɵelementStart(3, \"p-table\", 3);\n      i0.ɵɵtemplate(4, VerDocumentosComponent_ng_template_4_Template, 5, 0, \"ng-template\", 4);\n      i0.ɵɵtemplate(5, VerDocumentosComponent_ng_template_5_Template, 6, 2, \"ng-template\", 5);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"div\", 6)(7, \"button\", 7);\n      i0.ɵɵlistener(\"click\", function VerDocumentosComponent_Template_button_click_7_listener() {\n        return ctx.guardar();\n      });\n      i0.ɵɵtext(8, \"Guardar\");\n      i0.ɵɵelementEnd()()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"formGroup\", ctx.formDocumentos);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"value\", ctx.documentos.controls)(\"tableStyle\", i0.ɵɵpureFunction0(4, _c0));\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"disabled\", !ctx.formDocumentos.valid);\n    }\n  },\n  dependencies: [i1.PrimeTemplate, i2.ɵNgNoValidate, i2.NgControlStatus, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.FormControlName, i2.FormGroupName, i2.FormArrayName, i3.InputSwitch, i4.Table],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJ2ZXItZG9jdW1lbnRvcy5jb21wb25lbnQuY3NzIn0= */\"]\n});","map":{"version":3,"mappings":"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","names":["inject","DynamicDialogConfig","DynamicDialogRef","AuditoriaService","descargarArchivo","MessageService","SUBJECTS","TITLES","FormBuilder","SharedService","finalize","i0","VerDocumentosComponent","constructor","fb","group","data","array","documentos","formDocumentos","get","ngOnInit","config","_a","idAuditoria","auditoriaService","getDocumentos","subscribe","next","forEach","documento","push","fecha","id_documento","idDocumento","valido","error","err","closeDialog","descargarDocumento","id","getDocumento","descargar","documentoBase64","messageService","add","severity","summary","detail","base64","Date","now","ref","close","guardar","sharedService","cambiarEstado","validarDocumentos","value","pipe","exito","selectors","features","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["F:\\Bovis\\Front\\bovis-dev\\src\\app\\auditoria\\components\\ver-documentos\\ver-documentos.component.ts","F:\\Bovis\\Front\\bovis-dev\\src\\app\\auditoria\\components\\ver-documentos\\ver-documentos.component.html"],"sourcesContent":["import { Component, OnInit, inject } from '@angular/core';\r\nimport { DynamicDialogConfig, DynamicDialogRef } from 'primeng/dynamicdialog';\r\nimport { AuditoriaService } from '../../services/auditoria.service';\r\nimport { Documento } from '../../models/auditoria.model';\r\nimport { descargarArchivo } from 'src/helpers/helpers';\r\nimport { MessageService } from 'primeng/api';\r\nimport { SUBJECTS, TITLES } from 'src/utils/constants';\r\nimport { FormArray, FormBuilder } from '@angular/forms';\r\nimport { SharedService } from 'src/app/shared/services/shared.service';\r\nimport { finalize } from 'rxjs';\r\n\r\n@Component({\r\n  selector: 'app-ver-documentos',\r\n  templateUrl: './ver-documentos.component.html',\r\n  styleUrls: ['./ver-documentos.component.css'],\r\n  providers: [MessageService]\r\n})\r\nexport class VerDocumentosComponent implements OnInit {\r\n\r\n  auditoriaService  = inject(AuditoriaService)\r\n  config            = inject(DynamicDialogConfig)\r\n  fb                = inject(FormBuilder)\r\n  messageService    = inject(MessageService)\r\n  ref               = inject(DynamicDialogRef)\r\n  sharedService     = inject(SharedService)\r\n\r\n  // documentos: Documento[]\r\n  \r\n  formDocumentos = this.fb.group({\r\n    data: this.fb.array([])\r\n  })\r\n\r\n  constructor() { }\r\n  \r\n  get documentos() {\r\n    return this.formDocumentos.get('data') as FormArray\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    if(this.config.data?.idAuditoria) {\r\n      this.auditoriaService.getDocumentos(this.config.data.idAuditoria)\r\n        .subscribe({\r\n          next: ({data}) => {\r\n            data.forEach(documento => {\r\n                this.documentos.push(\r\n                  this.fb.group({\r\n                    fecha:        [documento.fecha],\r\n                    id_documento: [documento.idDocumento],\r\n                    valido:       [documento.valido]\r\n                  })\r\n                )\r\n              }\r\n            )\r\n          },\r\n          error: (err) => this.closeDialog()\r\n        })\r\n    } else {\r\n      this.closeDialog()\r\n    }\r\n  }\r\n\r\n  descargarDocumento(id: number) {\r\n    if(id != 0) {\r\n      this.auditoriaService.getDocumento(id)\r\n        .subscribe({\r\n          next: ({data}) => {\r\n            this.descargar(data.documentoBase64)\r\n          },\r\n          error: (err) => this.messageService.add({severity: 'error', summary: TITLES.error, detail: SUBJECTS.error})\r\n        })\r\n    }\r\n  }\r\n\r\n  async descargar(base64: string) {\r\n    await descargarArchivo(base64, `Documento_${Date.now()}`)\r\n  }\r\n\r\n  closeDialog() {\r\n    this.ref.close()\r\n  }\r\n\r\n  guardar() {\r\n    \r\n    this.sharedService.cambiarEstado(true)\r\n\r\n    this.auditoriaService.validarDocumentos(this.formDocumentos.value)\r\n      .pipe(finalize(() => this.sharedService.cambiarEstado(false)))\r\n      .subscribe({\r\n        next: (data) => {\r\n          this.ref.close({exito: true})\r\n        },\r\n        error: (err) =>  this.messageService.add({severity: 'error', summary: TITLES.error, detail: err.error})\r\n      })\r\n  }\r\n\r\n}\r\n","<form [formGroup]=\"formDocumentos\">\r\n  <div class=\"card\">\r\n    <ng-container formArrayName=\"data\">\r\n      <p-table [value]=\"documentos.controls\" [tableStyle]=\"{ 'min-width': '100%' }\" >\r\n          <ng-template pTemplate=\"header\">\r\n              <tr>\r\n                  <th>Documento</th>\r\n                  <th class=\"text-center\">Válido</th>\r\n              </tr>\r\n          </ng-template>\r\n          <ng-template pTemplate=\"body\" let-documento let-i=\"rowIndex\">\r\n              <tr [formGroupName]=\"i\">\r\n                  <td>\r\n                    <a \r\n                      class=\"text-success font-bold pointer\"\r\n                      (click)=\"descargarDocumento(documento.value.id_documento)\"\r\n                    >\r\n                      {{documento.value.fecha + '_' + documento.value.id_documento.toString()}}\r\n                    </a>\r\n                  </td>\r\n                  <td class=\"text-center\">\r\n                    <p-inputSwitch\r\n                      formControlName=\"valido\"\r\n                    ></p-inputSwitch>\r\n                  </td>\r\n              </tr>\r\n          </ng-template>\r\n      </p-table>\r\n    </ng-container>\r\n  </div>\r\n  \r\n  <div class=\"d-flex justify-content-center mt-4\">\r\n    <button type=\"button\" class=\"btn btn-info\" (click)=\"guardar()\" [disabled]=\"!formDocumentos.valid\">Guardar</button>\r\n  </div>\r\n</form>"]},"metadata":{},"sourceType":"module"}