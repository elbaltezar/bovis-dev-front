
<p-toast></p-toast>

<div>
    <div *ngIf="!readOnly">

        <form [formGroup]="formFecha" (ngSubmit)="guardarFechaAuditoria()">

            <div class="row">
                <div class="col-12">
                    <label for="email">Proxima Fecha de Auditoria:</label>
                      <p-calendar 
                      id="fechaAuditoria"
                      [showIcon]="true"
                      dateFormat="dd/mm/yy"
                      [style]="{ width: '100%' }"
                      [ngClass]="{'ng-invalid ng-dirty': esInvalidoFecha('fechaAuditoria')}"
                      formControlName="fechaAuditoria"
                    ></p-calendar>
                    <div *ngIf="esInvalidoFecha('fechaAuditoria')">
                      <small
                        class="error-msg"
                      >
                        {{ obtenerMensajeErrorFecha('fechaAuditoria') }}
                      </small>
                    </div>
                  </div>
            </div>

            

            <div class="d-flex justify-content-end mt-2">
                <button type="button" class="btn btn-info" (click)="guardarFechaAuditoria()" [disabled]="!formFecha.valid">Guardar Fecha Auditoria</button>
            </div>

        </form>
        

        <hr>
        
        <form [formGroup]="form" (ngSubmit)="guardar()">

            <div class="row">
                <div class="col-12">
                    <label for="id_tipo_comentario">Tipo comentario:</label>
                    <p-dropdown 
                        id="id_tipo_comentario"
                        [options]="tiposComentario"
                        placeholder="Seleccionar un tipo" 
                        optionLabel="name" 
                        [showClear]="true"
                        [style]="{ width: '100%' }"
                        formControlName="id_tipo_comentario"
                        [ngClass]="{'ng-invalid ng-dirty': esInvalido('id_tipo_comentario')}"
                        optionValue="code"
                    ></p-dropdown>
                    <div *ngIf="esInvalido('id_tipo_comentario')">
                        <small class="error-msg">
                            {{ obtenerMensajeError('id_tipo_comentario') }}
                        </small>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <label for="comentario">Comentario:</label>
                    <textarea 
                        rows="5" 
                        cols="30" 
                        pInputTextarea 
                        class="form-control"
                        [ngClass]="{'ng-invalid ng-dirty': esInvalido('comentario')}"
                        formControlName="comentario"
                    ></textarea>
                    <div *ngIf="esInvalido('comentario')">
                        <small class="error-msg">
                            {{ obtenerMensajeError('comentario') }}
                        </small>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end mt-2">
                <button type="button" class="btn btn-info" (click)="guardar()" [disabled]="!form.valid">Guardar</button>
            </div>

        </form>

        <hr>
    </div>

    <div>
        <p-accordion class="w-full">
            <p-accordionTab *ngFor="let tipoComentario of tiposComentario">
                <ng-template pTemplate="header">
                    <span class="flex align-items-center gap-2 w-full">
                        <span class="font-bold white-space-nowrap">{{ tipoComentario.name }}</span>
                        <p-badge [value]="comentarios[tipoComentario.code].length.toString()" class="ml-auto"></p-badge>
                    </span>
                </ng-template>
                <div *ngFor="let comentario of comentarios[tipoComentario.code]; let i = index">
                    <p class="text-justify">
                        <strong>{{ i + 1 }}.</strong> {{comentario.comentario}}
                    </p>
                </div>
            </p-accordionTab>
        </p-accordion>
    </div>
    
    <div *ngIf="readOnly">
        <hr>
        
        <div class="row">
            <div class="col-12">
                <p class="text-center">
                    <strong>Resultado</strong>
                </p>
                <p class="text-center">
                    El proyecto tuvo un resultado "[STATUS]", es decir, tiene aspectos positivos reseñables y cumple de manera íntegra con lo dispuesto en el Contrato (de acuerdo con la tabla de evaluación que se muestra debajo).
                </p>
                <p class="text-center">
                    Se informa que la próxima auditoría se llevará a cabo en el mes de noviembre de 2021.
                </p>
            </div>
        </div>
    </div>
</div>
